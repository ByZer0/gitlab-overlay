--- lib/gitlab/backend/shell.rb.orig	2013-05-17 11:52:49.390000000 +0200
+++ lib/gitlab/backend/shell.rb	2013-05-17 11:52:58.100000000 +0200
@@ -10,7 +10,7 @@
     #   add_repository("gitlab/gitlab-ci")
     #
     def add_repository(name)
-      system("#{gitlab_shell_user_home}/gitlab-shell/bin/gitlab-projects add-project #{name}.git")
+      system("#{Gitlab.config.gitlab_shell.path}/bin/gitlab-projects add-project #{name}.git")
     end
 
     # Import repository
@@ -21,7 +21,7 @@
     #   import_repository("gitlab/gitlab-ci", "https://github.com/randx/six.git")
     #
     def import_repository(name, url)
-      system("#{gitlab_shell_user_home}/gitlab-shell/bin/gitlab-projects import-project #{name}.git #{url}")
+      system("#{Gitlab.config.gitlab_shell.path}/bin/gitlab-projects import-project #{name}.git #{url}")
     end
 
     # Move repository
@@ -33,7 +33,7 @@
     #   mv_repository("gitlab/gitlab-ci", "randx/gitlab-ci-new.git")
     #
     def mv_repository(path, new_path)
-      system("#{gitlab_shell_user_home}/gitlab-shell/bin/gitlab-projects mv-project #{path}.git #{new_path}.git")
+      system("#{Gitlab.config.gitlab_shell.path}/bin/gitlab-projects mv-project #{path}.git #{new_path}.git")
     end
 
     # Remove repository from file system
@@ -44,7 +44,7 @@
     #   remove_repository("gitlab/gitlab-ci")
     #
     def remove_repository(name)
-      system("#{gitlab_shell_user_home}/gitlab-shell/bin/gitlab-projects rm-project #{name}.git")
+      system("#{Gitlab.config.gitlab_shell.path}/bin/gitlab-projects rm-project #{name}.git")
     end
 
     # Add new key to gitlab-shell
@@ -53,7 +53,7 @@
     #   add_key("key-42", "sha-rsa ...")
     #
     def add_key(key_id, key_content)
-      system("#{gitlab_shell_user_home}/gitlab-shell/bin/gitlab-keys add-key #{key_id} \"#{key_content}\"")
+      system("#{Gitlab.config.gitlab_shell.path}/bin/gitlab-keys add-key #{key_id} \"#{key_content}\"")
     end
 
     # Remove ssh key from gitlab shell
@@ -62,16 +62,12 @@
     #   remove_key("key-342", "sha-rsa ...")
     #
     def remove_key(key_id, key_content)
-      system("#{gitlab_shell_user_home}/gitlab-shell/bin/gitlab-keys rm-key #{key_id} \"#{key_content}\"")
+      system("#{Gitlab.config.gitlab_shell.path}/bin/gitlab-keys rm-key #{key_id} \"#{key_content}\"")
     end
 
     def url_to_repo path
       Gitlab.config.gitlab_shell.ssh_path_prefix + "#{path}.git"
     end
 
-    def gitlab_shell_user_home
-      File.expand_path("~#{Gitlab.config.gitlab_shell.ssh_user}")
-    end
-
   end
 end
